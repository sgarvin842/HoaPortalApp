@{
    ViewData["Title"] = "Contact Info";
}

<div class="container mt-5">
    <!-- Communication Preferences Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Communication Preferences</h5>
                    <form id="communicationForm">
                    <ul class="list-unstyled">
                        <li class="d-flex align-items-center">
                            <b style="min-width: 100px;">General:</b>
                            <div class="form-check form-check-inline ms-2">
                                <input class="form-check-input" type="radio" name="generalContactRadio" id="isGeneralEmail" value="Email" checked>
                                <label class="form-check-label" for="isGeneralEmail">Email</label>
                            </div>
                            <div class="form-check form-check-inline ms-3">
                                <input class="form-check-input" type="radio" name="generalContactRadio" id="isGeneralPaper" value="Paper">
                                <label class="form-check-label" for="isGeneralPaper">Paper</label>
                            </div>
                        </li>
                        <li class="d-flex align-items-center">
                            <b style="min-width: 100px;">Billing:</b>
                            <div class="form-check form-check-inline ms-2">
                                <input class="form-check-input" type="radio" name="billingContactRadio" id="isBillingEmail" value="Email" checked>
                                <label class="form-check-label" for="isBillingEmail">Email</label>
                            </div>
                            <div class="form-check form-check-inline ms-3">
                                <input class="form-check-input" type="radio" name="billingContactRadio" id="isBillingPaper" value="Paper">
                                <label class="form-check-label" for="isBillingPaper">Paper</label>
                            </div>
                        </li>
                    </ul>
                        <button id="communicationUpdate" class="btn btn-success mt-3" disabled>Update</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Directory Preferences Section -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Directory Preferences</h5>
                    <form id="directoryForm">
                    <ul class="list-unstyled">
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="hideName" checked>
                                <label class="form-check-label" for="hideName">Hide Name In Directory</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="hideEmail" checked>
                                <label class="form-check-label" for="hideEmail">Hide Email In Directory</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="hidePhone" checked>
                                <label class="form-check-label" for="hidePhone">Hide Phone In Directory</label>
                            </div>
                        </li>
                        <li>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="hideProperty" checked>
                                <label class="form-check-label" for="hideProperty">Hide Property In Directory</label>
                            </div>
                        </li>
                    </ul>

                        <button id="directoryUpdate" class="btn btn-success mt-3" disabled>Update</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Information Section -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Contact Information</h5>
            <ul id="contactList" class="list-group list-group-flush">
                <li id="574-265-1188" class="list-group-item d-flex align-items-center justify-content-between">
                    <span><b>Phone:</b> 574-265-1188</span>
                    <span>
                        <button class="btn btn-sm btn-outline-primary me-2">Edit</button>
                        <button class="btn btn-sm btn-outline-danger delete-btn" data-bs-target="#autopayModal" data-bs-toggle="modal" data-id="574-265-1188">Delete</button>
                    </span>
                </li>
                <li id="garvins84@yahoo.com" class="list-group-item d-flex align-items-center justify-content-between">
                    <span><b>Email:</b> garvins84@yahoo.com</span>
                    <span>
                        <button class="btn btn-sm btn-outline-primary me-2">Edit</button>
                        <button class="btn btn-sm btn-outline-danger delete-btn" data-bs-target="#autopayModal" data-bs-toggle="modal" data-id="garvins84@yahoo.com">Delete</button>
                    </span>
                </li>
            </ul>
            <form id="addContactInfo" class="d-none">
                <div id="contactTypeRegion" class="mb-3">
                    <label for="contactType" class="form-label">Contact Type</label>
                    <select class="form-select" id="contactType" required>
                        <option selected disabled>Contact Type</option>
                        <option value="Phone">Phone</option>
                        <option value="Email">Email</option>
                    </select>
                </div>
                <div id="phoneRegion" class="d-none mb-3">
                    <label for="phoneInput" class="form-label">Phone Number</label>
                    <input id="phoneInput" name="phone" type="tel" placeholder="123-456-7890" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" />
                </div>
                <div id="emialRegion" class="d-none mb-3">
                    <label for="emailInput" class="form-label">Email</label>
                    <input id="emailInput" name="email" type="email" placeholder="name@email.com" />
                </div>

                <button id="cancelContactBtn" class="d-none btn btn-secondary mt-3">Cancel</button>
                <button id="saveContactBtn" value="submit" class="d-none btn btn-success mt-3">Save</button>
            </form>
            <button id="addContactBtn" class="btn btn-success mt-3">Add New Contact</button>
        </div>
    </div>
    <partial name="ConfirmDeleteModal" />
</div>

<!-- Include Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const addEmailInput = document.getElementById('emialRegion');
        const addPhoneInput = document.getElementById('phoneRegion');
        const emailInput = document.getElementById('emailInput');
        const phoneInput = document.getElementById('phoneInput');
        const contactTypeInput = document.getElementById("contactType");
        const contactTypeRegion = document.getElementById("contactTypeRegion");
        const addContactBtn = document.getElementById('addContactBtn')
        const addContactInfoRegion = document.getElementById('addContactInfo');
        const saveContactBtn = document.getElementById('saveContactBtn');
        const addContactInfoForm = document.getElementById('addContactInfo');
        const contactList = document.getElementById('contactList');
        const communicationForm = document.getElementById('communicationForm');
        const directoryForm = document.getElementById('directoryForm');
        const directoryUpdate = document.getElementById('directoryUpdate');
        const communicationUpdate = document.getElementById('communicationUpdate');
        var toDeleteId = "";

        const deleteButtons = document.querySelectorAll('.delete-btn');

        directoryForm.addEventListener('input', function () {
            directoryUpdate.disabled = false;
        });

        communicationForm.addEventListener('input', function () {
            communicationUpdate.disabled = false;
        });

        // Add event listeners to each delete button
        deleteButtons.forEach(button => {
            button.addEventListener('click', function () {
                // Get the ID of the line item to be removed
                toDeleteId = this.getAttribute('data-id');
            });
        });

        $('#confirmDelete').on('click', function () {
            var elementToDelete = document.getElementById(toDeleteId);
            elementToDelete.remove();
        });

        // Show/Hide the partial payment input based on selection
        contactTypeInput.addEventListener('change', function () {
            if (contactTypeInput.value === 'Phone') {
                addEmailInput.classList.add('d-none');
                addPhoneInput.classList.remove('d-none');
                emailInput.removeAttribute("required");
                phoneInput.setAttribute("required", "");
            } else if (contactTypeInput.value === 'Email') {
                addEmailInput.classList.remove('d-none');
                addPhoneInput.classList.add('d-none');
                emailInput.setAttribute("required", "");
                phoneInput.removeAttribute("required");
            } else{
                addEmailInput.classList.add('d-none');
                addPhoneInput.classList.add('d-none');
                emailInput.removeAttribute("required");
                phoneInput.removeAttribute("required");
            }
        });

        addContactBtn.addEventListener('click', function () {
            if (addContactInfoRegion.classList.contains('d-none')) {
                addContactInfoRegion.classList.remove('d-none');
                addContactBtn.classList.add('d-none');
                saveContactBtn.classList.remove('d-none');
                cancelContactBtn.classList.remove('d-none');
            }
        });

        cancelContactBtn.addEventListener('click', function () {
            if (!addContactInfoRegion.classList.contains('d-none')) {
                addContactInfoRegion.classList.add('d-none');
                addContactBtn.classList.remove('d-none');
                saveContactBtn.classList.add('d-none');
                cancelContactBtn.classList.add('d-none');
                emailInput.removeAttribute("required");
                phoneInput.removeAttribute("required");
            }
        });

        addContactInfoForm.addEventListener('submit', function (e) {

            e.preventDefault();
            if (!addContactInfoForm.checkValidity()) {
                e.preventDefault();
            }else
            {
                var generatedValue = emailInput.value != '' ? emailInput.value : phoneInput.value;
                e.stopImmediatePropagation();
                if (!addContactInfoRegion.classList.contains('d-none')) {
                    addContactInfoRegion.classList.add('d-none');
                    addContactBtn.classList.remove('d-none');
                    saveContactBtn.classList.add('d-none');
                    cancelContactBtn.classList.add('d-none');
                }
                var li = document.createElement('li');
                li.className += 'list-group-item d-flex align-items-center justify-content-between';
                li.id = generatedValue;
                li.innerHTML = `
                            <span><b>${contactTypeInput.value}: </b> ${generatedValue}</span>
                    <span>
                    <button class="btn btn-sm btn-outline-primary me-2"> Edit </button>
                        <button class= "btn btn-sm btn-outline-danger" data-bs-target="#autopayModal" data-bs-toggle="modal" data-id="${generatedValue}" > Delete </button>
                    </span>`
                contactList.appendChild(li)
            }
        });

    });
</script>
<style>
    .card {
        border-radius: 10px;
    }

    .form-check-label {
        margin-left: 0.5rem;
    }

    .list-group-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-title {
        font-size: 1.25rem;
        font-weight: 500;
    }
</style>